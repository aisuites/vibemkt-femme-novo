{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dashboard - VibeMKT{% endblock %}

{% block content %}
<!-- Welcome Section -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-purple mb-2">
      Bem-vindo, {{ user_name }}! ğŸ‘‹
    </h1>
    <p class="text-lg text-muted">
      Aqui estÃ¡ o resumo das suas atividades de marketing com IA
    </p>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    
    <!-- Base de Conhecimento -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“š Base de Conhecimento</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          {% if kb_exists %}
            <div class="text-2xl font-bold text-purple">{{ kb_completude|floatformat:0 }}%</div>
            <div class="text-sm text-muted">Completude</div>
          {% else %}
            <div class="text-sm text-muted">NÃ£o configurada</div>
          {% endif %}
        </div>
        <a href="{% url 'knowledge:view' %}" class="btn btn-secondary btn-sm">
          {% if kb_exists %}Ver{% else %}Configurar{% endif %}
        </a>
      </div>
    </div>

    <!-- Pautas -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“ Pautas</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-purple">{{ pautas_total }}</div>
          <div class="text-sm text-muted">
            {{ pautas_pendentes }} pendente{{ pautas_pendentes|pluralize }}
          </div>
        </div>
        <a href="{% url 'content:pautas' %}" class="btn btn-primary btn-sm">
          Nova Pauta
        </a>
      </div>
    </div>

    <!-- Posts -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ¨ Posts</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-purple">{{ posts_total }}</div>
          <div class="text-sm text-muted">
            {{ posts_draft }} rascunho{{ posts_draft|pluralize }}, {{ posts_aprovados }} aprovado{{ posts_aprovados|pluralize }}
          </div>
        </div>
        <a href="{% url 'content:posts' %}" class="btn btn-primary btn-sm">
          Novo Post
        </a>
      </div>
    </div>

    <!-- Email MKT -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“¨ Email MKT</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-purple">{{ projetos_ativos }}</div>
          <div class="text-sm text-muted">Ativo{{ projetos_ativos|pluralize }}</div>
        </div>
        <a href="{% url 'campaigns:projects' %}" class="btn btn-primary btn-sm">
          Novo Email
        </a>
      </div>
    </div>

    <!-- Projetos -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ§‘ğŸ¬ VÃ­deos Avatar</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-purple">{{ projetos_ativos }}</div>
          <div class="text-sm text-muted">Ativo{{ projetos_ativos|pluralize }}</div>
        </div>
        <a href="{% url 'campaigns:projects' %}" class="btn btn-primary btn-sm">
          Novo VÃ­deo
        </a>
      </div>
    </div>

    <!-- AprovaÃ§Ãµes -->
    {% if aprovacoes_pendentes > 0 %}
    <div class="card" style="border-color: var(--femme-warning);">
      <div class="card-header">
        <h3 class="card-title">â³ AprovaÃ§Ãµes Pendentes</h3>
      </div>
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold" style="color: var(--femme-warning);">{{ aprovacoes_pendentes }}</div>
          <div class="text-sm text-muted">Aguardando sua aprovaÃ§Ã£o</div>
        </div>
        <a href="{% url 'campaigns:approvals' %}" class="btn btn-outline btn-sm">
          Revisar
        </a>
      </div>
    </div>
    {% endif %}

    <!-- Quotas de Uso -->
    {% if quota_info %}
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“Š Quotas de Uso</h3>
      </div>
      <div class="space-y-3">
        <!-- Pautas Hoje -->
        <div>
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs text-muted">Pautas Hoje</span>
            <span class="text-xs font-semibold">{{ quota_info.pautas_hoje }} / {{ quota_info.pautas_dia_max }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-1.5">
            <div class="h-1.5 rounded-full {% if quota_info.pautas_dia_percentual >= 100 %}bg-red-500{% elif quota_info.pautas_dia_percentual >= 80 %}bg-yellow-500{% else %}bg-purple{% endif %}" style="width: {{ quota_info.pautas_dia_percentual|floatformat:0 }}%;"></div>
          </div>
        </div>
        
        <!-- Posts Hoje -->
        <div>
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs text-muted">Posts Hoje</span>
            <span class="text-xs font-semibold">{{ quota_info.posts_hoje }} / {{ quota_info.posts_dia_max }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-1.5">
            <div class="h-1.5 rounded-full {% if quota_info.posts_dia_percentual >= 100 %}bg-red-500{% elif quota_info.posts_dia_percentual >= 80 %}bg-yellow-500{% else %}bg-purple{% endif %}" style="width: {{ quota_info.posts_dia_percentual|floatformat:0 }}%;"></div>
          </div>
        </div>
        
        <!-- Posts MÃªs -->
        <div>
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs text-muted">Posts MÃªs</span>
            <span class="text-xs font-semibold">{{ quota_info.posts_mes }} / {{ quota_info.posts_mes_max }}</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-1.5">
            <div class="h-1.5 rounded-full {% if quota_info.posts_mes_percentual >= 100 %}bg-red-500{% elif quota_info.posts_mes_percentual >= 80 %}bg-yellow-500{% else %}bg-purple{% endif %}" style="width: {{ quota_info.posts_mes_percentual|floatformat:0 }}%;"></div>
          </div>
        </div>
        
        <!-- Custo MÃªs -->
        <div class="pt-2 border-t border-gray-200">
          <div class="flex items-center justify-between">
            <span class="text-xs text-muted">Custo MÃªs</span>
            <span class="text-xs font-semibold">${{ quota_info.cost_mes|floatformat:2 }}</span>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Atividades Recentes -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ• Atividades Recentes</h3>
      </div>
      
      {% if atividades_recentes %}
        <div class="flex flex-col gap-3">
          {% for atividade in atividades_recentes %}
            <div class="flex items-start gap-3 p-3 rounded-lg" style="background: var(--femme-bg-alt);">
              <div class="flex-1">
                <div class="font-medium">{{ atividade.titulo }}</div>
                <div class="text-xs text-muted">
                  {{ atividade.tipo|title }} â€¢ {{ atividade.data|date:"d/m/Y H:i" }}
                </div>
              </div>
              <span class="badge badge-soft">{{ atividade.status }}</span>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center text-muted py-8">
          Nenhuma atividade recente
        </div>
      {% endif %}
    </div>

    <!-- Trends Recentes -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">ğŸ“ˆ Trends em Alta</h3>
        <a href="{% url 'content:trends' %}" class="link text-sm">Ver todas</a>
      </div>
      
      {% if trends_recentes %}
        <div class="flex flex-col gap-3">
          {% for trend in trends_recentes %}
            <div class="flex items-start gap-3 p-3 rounded-lg" style="background: var(--femme-bg-alt);">
              <div class="flex-1">
                <div class="font-medium">{{ trend.keyword }}</div>
                <div class="text-xs text-muted">
                  Score: {{ trend.trend_score }} â€¢ {{ trend.created_at|date:"d/m/Y" }}
                </div>
              </div>
              <span class="badge badge-{% if trend.relevance == 'high' %}success{% elif trend.relevance == 'medium' %}warning{% else %}soft{% endif %}">
                {{ trend.get_relevance_display }}
              </span>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center text-muted py-8">
          Nenhuma trend monitorada ainda
        </div>
      {% endif %}
    </div>

  </div>

  <!-- Quick Actions -->
  <div class="card mt-6">
    <div class="card-header">
      <h3 class="card-title">âš¡ AÃ§Ãµes RÃ¡pidas</h3>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <a href="{% url 'content:pautas' %}" class="btn btn-outline w-full">
        ğŸ“ Nova Pauta
      </a>
      <a href="{% url 'content:posts' %}" class="btn btn-outline w-full">
        ğŸ¨ Novo Post
      </a>
      <a href="{% url 'campaigns:projects' %}" class="btn btn-outline w-full">
        ğŸš€ Novo Projeto
      </a>
      <a href="{% url 'knowledge:view' %}" class="btn btn-outline w-full">
        ğŸ“š Base de Conhecimento
      </a>
    </div>
  </div>

{% endblock %}
